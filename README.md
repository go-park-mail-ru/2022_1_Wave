# [Wave Music](https://wave-music.online)

## The Best Musical Service

### © Team Wave

![Team Wave](https://wave-music.online/favicon.png "logo")

## Team:

#### Backend

- [Владислав Майцветов](https://github.com/Mausved)
- [Дмитрий Ильин](https://github.com/Neytrinoo)

#### [Frontend](https://github.com/frontend-park-mail-ru/2022_1_Wave)

- [Николай Куликов](https://github.com/NNKulickov)
- [Фарис Набиев](https://github.com/rflban)

## Бекенд

---

### Архитектура

В основе архитектуры лежит "чистая архитектуры Дяди Боба" с применением микросервисов на gRPC. В проекте присутствует
разделение на следующие слои:

1. доставка (delivery)
2. бизнес-логика (useCase)
3. агент (agent)
4. сервис (gRPC)
5. репозиторий (repository)

Каждый слой включает в себя один уровень ниже. Каждый слой не должен включать в себя слой выше или слой из этого же
уровня. Данный подход позволяет относительно недорого масштабироваться и уменьшает стоимость внедрения новых
возможностей сервиса. Новым разработчикам достаточно следовать этому паттерну, что позволяет им быстро вкатиться в
разработку.

**Схема:**

![схема](https://github.com/bxcodec/go-clean-arch/raw/master/clean-arch.png "схема")

*Примечание: в нашем проекте добавлены слои агентов и gRPC. Агент - это посредник между бизнес-логикой и самим сервисом.
Эта сущность инкапсулирует особенности обращения к gRPC (сигнатуру вызываемых методов сервиса).*

---

### gRPC

В проекте есть следующие сервисы-gRPC:

- альбом (album)
- артист (artist)
- трек (track)
- плейлист (playlist)
- пользователь (user)
- аутентификация (auth)
- сокращатель ссылок (linker)
- веб-сокет сервер для синхронизации между устройствами (websocket)

---

### Сервер

Для серверной разработки используем легковесный и быстрый [Echo](https://echo.labstack.com/). Для прокси
настроили [nginx](https://nginx.org/).

---

### Основная база

Подключили [Postgres](https://www.postgresql.org/)

### Хранение сессий пользователей

Юзаем ин-мемори хранилище данных [Redis](https://redis.io/)

### Хранение ссылок

Развернули документоориентированную систему [MongoDB](https://www.mongodb.com/)

---

### Docker

Под каждый сервис собран легковесный [docker-образ](https://www.docker.com/) (в основном
на [Ubuntu](https://ubuntu.com/))

### CI/CD

Развернули кластер на [K8S](https://kubernetes.io/ru/). Используем
встроенный [Github Actions](https://github.com/features/actions) для автодеплоя на кластер. На кластере находятся все
компоненты приложения за исключением постгриса и монги (они на другой тачке). Все образы подгружаются с
нашего [dockerHub](https://hub.docker.com/).

---

### Метрики и алерты

К каждому сервису ходит [Prometheus](https://prometheus.io/) для сбора метрик.
Настроили [Alertmanager](https://prometheus.io/docs/alerting/latest/alertmanager/) с алертингом в телеграм для
оповещении о состоянии сервисов. А в оценке происходящего с дашбордов нам помогает [Grafana](https://grafana.com/).

---

### Документация

Сбилдили удобную доку через [swagger](https://github.com/swaggo/swag)

### Summary

В проекте **20623** строчек go-кода (*01.06.2022 22:15 GMT+3*)



